<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>{% block title %}{% endblock %} - MIT Textbooks</title>

  <!-- Meta -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="description" content="{% block description %}{% endblock %}">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <meta property="og:title" content="{% block og_title %}{% endblock %}">
  <meta property="og:site_name" content="MIT Textbooks">
  <meta property="og:description" content="{% block og_description %}{% endblock %}">
  <meta property="fb:app_id" content="1497643403780485">
  <meta property="og:type" content="website">

  {% block meta %}{% endblock %}

  <meta name="msvalidate.01" content="7B0592436DCE727FBAD7B26EE16EBBCC">
  <meta name="google-site-verification" content="oTo-jNwvcMf_7vysWC4ynfB0MKO1YGjf_FaXCbFjIsc">

  {% block img %}<meta property="og:image" content="{{ url_for('static', filename='images/seal.jpg', _external=True) }}">{% endblock %}
  
  <!-- Link -->
  <link rel="shortcut icon" href="{{ url_for('static', filename='images/favicon.ico') }}">
  <link rel='search' href="{{ url_for('opensearchdescription_view') }}" type='application/opensearchdescription+xml' title='MIT Textbooks'>

  {% block link %}{% endblock %}

  <!-- CSS -->
  <link href="//netdna.bootstrapcdn.com/bootswatch/3.1.1/simplex/bootstrap.min.css" rel="stylesheet">
  <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">

  {% block css %}{% endblock %}

  <!-- JS -->
  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->
  <script src='//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.6.0/underscore-min.js'></script>
  <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.0/jquery.cookie.min.js"></script>
  <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
  
  {% block js %}{% endblock %}

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-45034901-1', 'mit.edu');
    ga('send', 'pageview');
  </script>
  
</head>
<body>

  <!-- Header -->
  {% include 'header.html' %}

  <div class="container">
    <div class="main">
      {% block header %}{% endblock %}

      <!-- Messages -->
      <div id="messages">
          {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
              {% for category, message in messages %}
               <div class="alert alert-{{ category }} alert-dismissable">
                <button type="button" class="close" data-dismiss="alert" aria-hidden="true">Ã—</button>
                {{ message|safe }}
              </div>
              {% endfor %}
            {% endif %}
          {% endwith %}
      </div>

      
      <!-- Body -->
      {% block body %}{% endblock %}


      <!-- Footer -->  
      {% block footer %}{% endblock %}

      {% include 'footer.html' %}
    </div>
  </div>
  <span style='display:none;' id='mit-tb-home'></span>
  <script type="text/javascript" src="{{ url_for('static', filename='js/functions.js') }}"></script>
  <script>
    window.fbAsyncInit = function() {
      FB.init({
        appId      : '1497643403780485',
        xfbml      : true,
        version    : 'v2.0'
      });
    };

    (function(d, s, id){
       var js, fjs = d.getElementsByTagName(s)[0];
       if (d.getElementById(id)) {return;}
       js = d.createElement(s); js.id = id; js.async = true;
       js.src = "//connect.facebook.net/en_US/sdk.js";
       fjs.parentNode.insertBefore(js, fjs);
     }(document, 'script', 'facebook-jssdk'));

    var trackOutboundLink = function(url, c, s) {
      ga('send', 'event', 'outbound', s.toLowerCase(), url, c*.04);
      window.open(url);
    }
  </script>
  <script>
  {% if not g.user %}
    $(document).ready(function() {
      if ($.cookie('id_email') == undefined) {
        $.get( "https://tb.mit.edu:444/auth/auth.php", function(data) {
          if (data.email) {
            $.cookie('id_email', data.email);
            $.cookie('id_name', data.name);
            ga('send', 'event', 'view', 'user', data.email);
            ga('set', '&uid', data.email);
            location.reload();
          }
        });
      }
    });
  {% else %}
      ga('send', 'event', 'view', 'user', "{{ g.user.get_id() }}");
      ga('set', '&uid', "{{ g.user.get_id() }}");
  {% endif %}
  </script>
</body>
</html>